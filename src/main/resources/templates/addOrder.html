<!DOCTYPE html>
<html th:replace="~{fragments/layout::layoutFragment (~{::title}, ~{::section}, ~{}, ~{})}"
      xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="UTF-8">
  <title>마니보고 주문관리 서비스 V2 - 주문생성</title>
</head>
<body>

<section class="container-fluid p-4" style="max-width: 1440px;">

<div class="d-flex align-items-end gap-3">

    <h3>주문 생성</h3>

    <div class="flex-grow-1"></div>

    <button type="button" class="btn btn-secondary">목록으로</button>
    <button type="submit" class="btn btn-primary">완료</button>
  </div>

<hr class="mb-4 mb-lg-5" />

<form th:method="POST" th:object="${form}" >

  <div class="row">

    <div class="col-12 col-xl-8 mb-5 mb-xl-0">

      <h4 class="mb-4">주문하시는 분</h4>

      <div class="row mb-2">
        <div class="col-4 col-md-auto mb-3">
          <label class="form-label">구매자명</label>
          <input type="text" class="form-control" placeholder="홍길동" />
        </div>
        <div class="col-4 col-md-auto mb-3">
          <label class="form-label">전화번호</label>
          <input type="text" class="form-control" placeholder="010-0000-0000" />
        </div>
      </div>

      <div class="row mb-5">
        <div class="col-12 ">
          <label class="form-label">고객메모</label>
          <textarea class="form-control" rows="4"></textarea>
        </div>
      </div>

      <hr class="mb-5" />

      <h4 class="mb-4">받으시는 분</h4>

      <div class="row mb-4">
        <div class="col-4 col-md-auto">
          <label class="form-label">수취인명</label>
          <input type="text" class="form-control" placeholder="홍길동" />
        </div>
        <div class="col-4 col-md-auto">
          <label class="form-label">전화번호1</label>
          <input type="text" class="form-control" placeholder="010-0000-0000" />
        </div>
        <div class="col-4 col-md-auto">
          <label class="form-label">전화번호2</label>
          <input type="text" class="form-control" placeholder="010-0000-0000" />
        </div>
      </div>

      <div class="row">
        <div class="col-6 col-sm-auto">
          <label class="form-label">우편번호</label>
          <div class="input-group mb-3">
            <input type="number" class="form-control" readonly>
            <button class="btn btn-outline-primary" type="button">검색</button>
          </div>
        </div>
      </div>

      <div class="row mb-5">

        <div class="col-12 col-xl-7 mb-3">
          <label class="form-label">기본주소</label>
          <input type="text" class="form-control" readonly />
        </div>

        <div class="col-12 col-xl-5">
          <label class="form-label">상세주소</label>
          <input type="text" class="form-control" />
        </div>
      </div>

      <hr class="mb-5" />

      <h4 class="mb-4">배송정보</h4>

      <div class="row">

        <div class="col-4 col-md-auto mb-4 mb-md-3">
          <label class="form-label">배송방법</label>
          <select class="form-select">
            <option selected th:value="null">선택</option>
            <option>직접배송</option>
            <option>택배/등기/소포</option>
          </select>
        </div>

        <div class="col-4 col-md-auto mb-4 mb-md-3">
          <label class="form-label">운임비</label>
          <select class="form-select">
            <option selected th:value="null">선택</option>
            <option>직접배송</option>
            <option>택배/등기/소포</option>
          </select>
        </div>


        <div class="col-6 col-md-auto mb-3">
          <label class="form-label">발송기한</label>
          <input type="date" class="form-control" />
          <div class="form-check form-text">
            <label class="form-check-label">
              31일 후로 설정
            </label>
            <input class="form-check-input" type="checkbox">
          </div>
        </div>

        <div class="col-6 col-md-auto">
          <label class="form-label">희망배송일</label>
          <input type="date" class="form-control" />
          <div class="form-check form-text">
            <label class="form-check-label">
              31일 후로 설정
            </label>
            <input class="form-check-input" type="checkbox">
          </div>
        </div>

      </div>

      <div class="row">

        <div class="col-12">
          <label class="form-label">배송메모</label>
          <textarea class="form-control"
                    rows="5"
                    data-bs-toggle="tooltip"
                    data-bs-placement="right"
                    data-bs-title="배송팀에 전달할 메시지를 입력하세요. 서명시 고객이 볼수 있으니 주의하세요."
          ></textarea>
        </div>
      </div>

    </div>


    <div class="col-12 col-xl-4">

      <h4 class="mb-4">상품정보</h4>


      <div class="row">
        <div class="col-12 col-md-8 mb-3">
          <label for="selectProductNumber" class="form-label">상품명</label>
          <select id="selectProductNumber" class="form-select" name="newProductNumber">
            <option selected th:value="null">선택</option>
            <option th:each="product : ${products.values()}" th:value="${product.number}" th:text="${product.name}"></option>
          </select>
        </div>

        <div class="col-12 col-md-4 mb-3">
          <label for="iptNewAmount" class="form-label">주문수량</label>
          <input type="number" class="form-control" id="iptNewAmount" name="newAmount" value="1" min="1" >
        </div>
      </div>

      <div class="d-flex">
        <div class="flex-grow-1"></div>
        <button type="submit"
                class="btn btn-outline-primary text-nowrap"
                th:formaction="|@{/v2/orders/add/addItemOrder}|">
          상품선택
        </button>
      </div>

      <div style="height: 32px;"></div>


      <div class="card p-3 mb-4" th:each="itemOrder, stat : *{itemOrderForms}">

        <th:block th:if="${stat.last}">
          <div id="lastItemOrder" style="height: 1px;"></div>
        </th:block>

        <div class="mb-2"></div>

        <div class="row">

          <div class="col-12 col-md-8 mb-3">

            <input type="hidden" th:field="*{itemOrderForms[__${stat.index}__].productNumber}">

            <label th:for="|itemOrderForms${stat.index}.productName|" class="form-label">상품명</label>
            <input class="form-control" type="text"
                   th:value="${products.get(itemOrder.productNumber)?.name}"
                   th:id="|itemOrderForms${stat.index}.productName|" readonly />
          </div>

          <div class="col-12 col-md-4 mb-3">
            <label th:for="|itemOrderForms${stat.index}.amount|" class="form-label">주문수량</label>
            <input type="number" class="form-control" th:field="*{itemOrderForms[__${stat.index}__].amount}">
          </div>

        </div>

        <hr class="mb-4"/>

        <div class="row">
          <div class="col-12 col-md-4 col-xl-6 mb-3"
               th:each="key : ${productOptions?.get(itemOrder.productNumber)?.keySet()}">
            <label class="form-label"
                   th:for="|itemOrderForms${stat.index}.options${keyStat.index}.value|"
                   th:text="${key}">
              옵션키
            </label>

            <input type="hidden" th:name="|itemOrderForms[${stat.index}].options[${keyStat.index}].key|" th:value="${key}">

            <select class="form-select"
                    th:field="*{itemOrderForms[__${stat.index}__].options[__${keyStat.index}__].value}">
              <option selected="selected" th:value="null">선택</option>
              <option th:each="variant : ${productOptions.get(itemOrder.productNumber).get(key)}" th:value="${variant.value}" th:text="${variant.label}"></option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col-12 col-md-6 col-xl-12 mb-3">
            <label th:for="|itemOrderForms${stat.index}.purchaseMemo|" class="form-label">발주메모</label>
            <textarea class="form-control"
                      th:field="*{itemOrderForms[__${stat.index}__].purchaseMemo}"
                      rows="2"
                      data-bs-toggle="tooltip"
                      data-bs-placement="right"
                      data-bs-title="공장에 전달할 메세지를 입력해 주세요."
            ></textarea>
          </div>
        </div>
      </div>

    </div>

  </div>

</form>


</section>
</body>
</html>